#:import sys sys
#:import MapSource kivy_garden.mapview.MapSource

ScreenManager:
    WelcomeScreen:
    MainScreen:
    LoginScreen:
    SignupScreen:
    LocationScreen:

<WelcomeScreen>:
    name:'welcomescreen'
    MDCard:
        size_hint: None, None
        size: 270, 400
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        elevation: 10
        padding: 25
        spacing: 25

        orientation:"vertical"
        Image:
            id: avatar
            size_hint: None, None
            size: "180dp", "180dp"
            source: "logo.png"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

        MDLabel:
            text: "Safety Car Asisstant"
            font_size: 20
            halign: 'center'
            size_hint_y: None
            height: self.texture_size[1]
            padding_y: 2
            color: (240/255, 133/255, 43/255)
            bold: True
            outline_color: (0,0,0)
            outline_width: 1
        MDRoundFlatIconButton:
            text: "LOG IN"
            icon: "login"
            size_hint_x: None
            width: 100
            font_size:12
            pos_hint: {"center_x": 0.5}
            on_press:
                root.manager.current = 'loginscreen'
                root.manager.transition.direction = 'left'

        MDRoundFlatIconButton:
            text: "Sign Up"
            icon: "account-badge-horizontal"
            size_hint_x: None
            width: 100
            font_size:12
            pos_hint: {"center_x": 0.5}
            on_press:
                root.manager.current = 'signupscreen'
                root.manager.transition.direction = 'left'

<LoginScreen>:
    name:'loginscreen'
    MDCard:
        size_hint: None, None
        size: 250, 400
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        elevation: 10
        padding: 25
        spacing: 25

        orientation:"vertical"
        Image:
            id: avatar
            size_hint: None, None
            size: "50dp", "50dp"
            source: "logo.png"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

        MDLabel:
            text:'LOGIN'
            font_size: 20
            halign: 'center'
            height: self.texture_size[1]
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            color: (240/255, 133/255, 43/255)
            bold: True
            outline_color: (0,0,0)
            outline_width: 1

        MDTextField:
            id:login_email
            hint_text: "Email"
            icon_right: "email"
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            helper_text_mode:  'on_error'
            icon_right_color: app.theme_cls.primary_color
            required: True
            mode: "rectangle"
        MDTextField:
            id:login_password
            hint_text: "Password"
            icon_right: "key"
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            password: True
            helper_text_mode:  'on_error'
            icon_right_color: app.theme_cls.primary_color
            required: True
            mode: "rectangle"


        MDRoundFlatIconButton:
            text:'Login'
            icon: "login"
            size_hint_x: None
            width: 100
            font_size:12
            pos_hint: {"center_x": 0.5}
            on_press:
                app.login()
                app.username_changer()

        MDRoundFlatIconButton:
            text: 'Create an account'
            icon: "login"
            size_hint_x: None
            width: 180
            font_size:12
            pos_hint: {"center_x": 0.5, "center_y": 0.8}
            on_press:
                root.manager.current = 'signupscreen'
                root.manager.transition.direction = 'up'


<SignupScreen>:
    name:'signupscreen'
    MDCard:
        size_hint: None, None
        size: 250, 400
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        elevation: 10
        padding: 25
        spacing: 13

        orientation:"vertical"

        Image:
            id: avatar
            size_hint: None, None
            size: "50dp", "50dp"
            source: "logo.png"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

        MDLabel:
            text:'Sign Up'
            font_size: 20
            halign: 'center'
            height: self.texture_size[1]
            size_hint_x: None
            width: 200
            pos_hint: {"center_x": 0.5}
            color: (240/255, 133/255, 43/255)
            bold: True
            outline_color: (0,0,0)
            outline_width: 1

        MDTextField:
            id:signup_email
            hint_text: "Email"
            icon_right: "email"
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            helper_text:'Required'
            helper_text_mode:  'on_error'
            icon_right_color: app.theme_cls.primary_color
            required: True
            mode: "rectangle"

        MDTextField:
            id:signup_username
            hint_text: "Usename"
            icon_right: "account"
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            helper_text:'Required'
            helper_text_mode:  'on_error'
            icon_right: 'account'
            icon_right_color: app.theme_cls.primary_color
            required: True
            mode: "rectangle"

        MDTextField:
            id:signup_password
            hint_text: "Password"
            icon_right: "key"
            size_hint_x: None
            width: 200
            font_size: 18
            pos_hint: {"center_x": 0.5}
            helper_text:'Required'
            helper_text_mode:  'on_error'
            icon_right_color: app.theme_cls.primary_color
            required: True
            mode: "rectangle"

        MDRoundFlatIconButton:
            text:'Signup'
            icon: "login"
            size_hint_x: None
            width: 100
            font_size:12
            pos_hint: {"center_x": 0.5}
            on_press: app.signup()

        MDRoundFlatIconButton:
            text: 'Already have an account'
            icon: "login"
            size_hint_x: None
            width: 200
            font_size:12
            pos_hint: {"center_x": 0.5}
            on_press:
                root.manager.current = 'loginscreen'
                root.manager.transition.direction = 'down'

<MainScreen>:
    name: 'mainscreen'
    BoxLayout:
        orientation:'vertical'
        MDBottomNavigation:
            panel_color: .2, .2, .2, 1
            MDBottomNavigationItem:
                name: 'screen 3'
                text: 'Monitoring'
                icon: 'monitor'

                BoxLayout:
                    orientation:'vertical'
                    size_hint: None, None
                    size: 250, 400
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}
                    elevation: 10
                    padding: 5
                    spacing: 5
                    canvas.before:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: 'mobil.jpg'

                    MDLabel:
                        text:'DRIVER'
                        font_size: 15
                        halign: 'center'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        font_style: 'Button'
                        color: (100/255, 128/255, 244/255)
                        bold: True
                        outline_color: (0,0,0,.5)
                        outline_width: 1
                    MDLabel:
                        id :status_driver
                        text:'normal'
                        font_size: 15
                        halign: 'center'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDLabel:
                        text:'NODE 1'
                        font_size: 15
                        halign: 'right'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                        bold: True
                        outline_color: (0,0,0)
                        outline_width: 1

                    MDLabel:
                        id:node_1
                        text:'HC/CO'
                        font_size: 15
                        halign: 'right'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDLabel:
                        text:'NODE 2'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                        bold: True
                        outline_color: (0,0,0)
                        outline_width: 1
                    MDLabel:
                        id:node_2
                        text:'HC/CO'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDLabel:
                        text:'NODE 3'
                        font_size: 15
                        halign: 'right'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                        bold: True
                        outline_color: (0,0,0)
                        outline_width: 1
                    MDLabel:
                        id:node_3
                        text:'HC/CO'
                        font_size: 15
                        halign: 'right'
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDLabel:
                        text:'NODE 4'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                        bold: True
                        outline_color: (0,0,0)
                        outline_width: 1
                    MDLabel:
                        id:node_4
                        text:'CO/HC'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDLabel:
                        text:'Status Gas'
                        halign: 'center'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                        bold: True
                        outline_color: (0,0,0)
                        outline_width: 1
                    MDLabel:
                        id:status_gas
                        text:'NORMAL'
                        halign: 'center'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        text_color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'
                    MDLabel:
                        id:loc
                        text:'-'
                        halign: 'center'
                        font_size: 15
                        height: self.texture_size[1]
                        size_hint_x: None
                        width: 200
                        pos_hint: {"center_x": 0.5}
                        theme_text_color: "Custom"
                        color: 100/255, 128/255, 244/255, 1
                        font_style: 'Subtitle2'

                    MDRoundFlatIconButton:
                        text:'MONITORING'
                        icon: "monitor"
                        size_hint_x: None
                        width: 100
                        font_size:12
                        pos_hint: {"center_x": 0.5}
                        on_press:
                            app.ondatabase()

            MDBottomNavigationItem:
                name: 'screen 1'
                text: 'Map'
                icon: 'map'

                MapView:
                    id: mapview
                    lat: -7.644153
                    lon: 111.414883
                    zoom: 13
                    double_tap_zoom: True
                    map_source: MapSource(sys.argv[1], attribution="") if len(sys.argv) > 1 else "osm"
                    MapMarkerPopup:
                        id: mapmaker
                        lat: -7.644153
                        lon: 111.414883
                        popup_size: dp(200), dp(100)
                        source: "POP_UP_MAX.png"
                        Bubble:
                            BoxLayout:
                                orientation: "horizontal"
                                padding: "5dp"
                                AsyncImage:
                                    source: "logo.png"
                                    mipmap: True
                                Label:
                                    text: "[b]Posisi Mobil[/b]"
                                    markup: True
                                    halign: "center"

                MDRoundFlatIconButton:
                    text:'MOVE'
                    icon: "map"
                    size_hint_x: None
                    width: 100
                    font_size:12
                    pos_hint: {"center_x": 0.5}
                    on_release:
                        app.loc()

            MDBottomNavigationItem:
                name: 'screen 2'
                text: 'Log Out'
                icon: 'logout'

                on_tab_press:
                    root.manager.current = 'loginscreen'
                    root.manager.transition.direction = 'down'


